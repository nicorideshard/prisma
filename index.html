<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prestamo de Libros</title>
</head>
<body>
    <h1>Prestamo de Libros</h1>
    <label for="codigoUsuario">Código de Usuario:</label>
    <input type="text" id="codigoUsuario">
    <br>
    <label for="nombreLibro">Código del Libro:</label>
    <input type="text" id="codigoLibro">
    <button onclick="consultarLibro()">Consultar</button>
    <br>
    <label for="nombreLibro">Nombre del Libro:</label>
    <input type="text" id="nombreLibro" readonly>
    <br>
    <label for="autorLibro">Autor del Libro:</label>
    <input type="text" id="autorLibro" readonly>
    <br>
    <label for="costoLibro">Costo del Libro:</label>
    <input type="text" id="costoLibro" readonly>
    <br>
    <label for="totalLibros">Total de Libros:</label>
    <input type="text" id="totalLibros" readonly>
    <br>
    <button onclick="grabarPrestamo()">Grabar Préstamo</button>

    <script>
        async function consultarLibro() {
            const codigoLibro = document.getElementById('codigoLibro').value;
            try {
                // Consulta a la API de libros
                const response = await fetch(`https://api-libros.com/libros/${codigoLibro}`);
                const libro = await prisma.libro.findUnique({
                    where: { codigo: codigoLibro },
                });

                // Consulta a la API de clientes
                const responseCliente = await fetch(`https://api-clientes.com/clientes/${codigoCliente}`);
                const cliente = await prisma.cliente.findUnique({
                    where: { codigo: codigoCliente },
                });

                // Verificar si el libro existe
                if (libro && libro.codigoLibro) {
                    // Rellenar los campos con la información del libro
                    document.getElementById('nombreLibro').value = libro.nombreLibro;
                    document.getElementById('autorLibro').value = libro.autorLibro;
                    document.getElementById('costoLibro').value = libro.costoLibro;
                } else {
                    // Mostrar mensaje si el libro no existe
                    alert("Libro con código no existente");
                    // Limpiar los campos si el libro no existe
                    document.getElementById('nombreLibro').value = '';
                    document.getElementById('autorLibro').value = '';
                    document.getElementById('costoLibro').value = '';
                }
            } catch (error) {
                console.error(error);
                alert("Error al consultar la API de libros");
            }
        }

        async function grabarPrestamo() {
            const codigoUsuario = document.getElementById('codigoUsuario').value;
            const codigoLibro = document.getElementById('codigoLibro').value;

            try {
                // Consulta a la API para grabar el préstamo
                const response = await fetch('https://api-prestamos.com/prestamo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        codigoUsuario: codigoUsuario,
                        codigoLibro: codigoLibro,
                    }),
                });

                const resultado = await response.json();

                // Realizar operaciones con el resultado si es necesario
                console.log(resultado);

            } catch (error) {
                console.error(error);
                alert("Error al grabar el préstamo");
            }
        }
    </script>
</body>
</html>

